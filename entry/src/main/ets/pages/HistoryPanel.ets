import { CalculationHistory } from '../common/utils/types';

@Component
export default struct HistoryPanel {
  @Link isShow: boolean;
  @Link history: CalculationHistory[]; // ä½¿ç”¨æ˜ç¡®å®šä¹‰çš„æ¥å£ç±»å‹

  build() {
    if (this.isShow) {
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('#50000000')
        .onClick(() => this.isShow = false)
        .position({ x: 0, y: 0 })
        .zIndex(-1)

      Column() {
        // æ ‡é¢˜æ 
        Row() {
          Text('å†å²è®°å½•')
            .fontSize(18)
            .fontWeight(FontWeight.Medium)

          Button('å…³é—­')
            .onClick(() => this.isShow = false)
            .margin({ left: 8 })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceBetween)
        .padding(12)

        // å†…å®¹åŒºåŸŸ
        Column() {
          if (this.history.length === 0) {
            // ç©ºçŠ¶æ€
            Column() {
              Text('æš‚æ— è®¡ç®—å†å²ã€‚')
                .margin({ top: 8 })
                .opacity(0.6)
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
          } else {
            // å†å²è®°å½•åˆ—è¡¨
            List() {
              ForEach(this.history.slice().reverse(), (item: CalculationHistory) => {
                ListItem() {
                  Column() {
                    // è¿‡ç¨‹æ–‡æœ¬å³å¯¹é½
                    Text(item.process)
                      .fontSize(14)
                      .textAlign(TextAlign.End)
                      .width('100%')

                    // ç»“æœæ–‡æœ¬å³å¯¹é½ï¼ˆæ›´å¤§å­—å·ï¼‰
                    Text(item.result)
                      .fontSize(18)
                      .margin({ top: 4 })
                      .textAlign(TextAlign.End)
                      .width('100%')
                  }
                  .width('100%')
                  .padding(12)
                }
                .borderRadius(8)
                .backgroundColor('#FFF')
                .margin({ bottom: 8 })
              })
            }
            .width('100%')
            .height('100%')
          }
        }
        .layoutWeight(1)
        .padding(12)
        .backgroundColor('#F7F8FA')

        // æ¸…ç©ºæŒ‰é’®ï¼ˆå›ºå®šåœ¨å³ä¸‹è§’ï¼‰
        Button('ğŸ—‘ï¸') // Unicodeåƒåœ¾æ¡¶ç¬¦å·
          .width(40)
          .height(40)
          .alignSelf(ItemAlign.End)
          .backgroundColor('#FF5252') // çº¢è‰²è­¦ç¤ºè‰²
          .fontColor(Color.White)
          .onClick(() => {
            this.history = []; // æ¸…ç©ºå†å²è®°å½•
          })
          .opacity(this.history.length > 0 ? 1 : 0) // æ— è®°å½•æ—¶éšè—
      }
      .width('100%')
      .height('70%')
      .position({ x: 0, y: '30%' })
      .backgroundColor('#FFF')
      .border({ width: 1, color: '#EEE' })
      .shadow({ radius: 16, color: '#10000000' })
    }
  }
}